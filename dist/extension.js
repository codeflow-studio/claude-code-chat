(()=>{"use strict";var e={63:function(e,t,s){var r,i=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,i)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=r(e),o=0;o<s.length;o++)"default"!==s[o]&&i(t,e,s[o]);return n(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ChatWebviewProvider=void 0;const a=o(s(398)),c=s(185);class d{constructor(e,t){this._extensionUri=e,this._claudeCodeService=t,this._messageListeners=[]}resolveWebviewView(e,t,s){this._view=e,e.webview.options={enableScripts:!0,localResourceRoots:[this._extensionUri]},e.webview.html=this._getHtmlForWebview(e.webview),e.webview.onDidReceiveMessage((e=>{"sendMessage"!==e.command||this._handleUserMessage(e.text)}),void 0,[]),this._setupClaudeCodeListeners()}_setupClaudeCodeListeners(){this._disposeMessageListeners(),this._messageListeners.push(this._claudeCodeService.onMessage((e=>{this._view&&this._view.webview.postMessage({command:"receiveMessage",sender:e.role,text:e.content,timestamp:(new Date).toISOString()})}))),this._messageListeners.push(this._claudeCodeService.onError((e=>{this._view&&(this._view.webview.postMessage({command:"receiveMessage",sender:"claude",text:`⚠️ Error: ${e}`,timestamp:(new Date).toISOString()}),a.window.showErrorMessage(`Claude Code error: ${e}`))}))),this._messageListeners.push(this._claudeCodeService.onExit((e=>{this._view&&(0!==e&&this._view.webview.postMessage({command:"receiveMessage",sender:"claude",text:"Claude Code process exited. Attempting to restart...",timestamp:(new Date).toISOString()}),setTimeout((()=>{this._claudeCodeService.start().catch((e=>{const t=e instanceof Error?e.message:String(e);a.window.showErrorMessage(`Failed to restart Claude Code: ${t}`),this._view?.webview.postMessage({command:"receiveMessage",sender:"claude",text:"⚠️ Error restarting Claude Code. Please try again or restart VS Code.",timestamp:(new Date).toISOString()})}))}),2e3))})))}_disposeMessageListeners(){for(const e of this._messageListeners)e.dispose();this._messageListeners=[]}async _handleUserMessage(e){try{await this._claudeCodeService.sendMessage(e)}catch(e){if(!this._view)return;const t=e instanceof Error?e.message:String(e);this._view.webview.postMessage({command:"receiveMessage",sender:"claude",text:`⚠️ Error: Failed to send message to Claude Code. ${t}`,timestamp:(new Date).toISOString()}),a.window.showErrorMessage(`Failed to send message to Claude Code: ${t}`)}}_getHtmlForWebview(e){const t=(0,c.getNonce)(),s=e.asWebviewUri(a.Uri.joinPath(this._extensionUri,"media","styles.css")),r=e.asWebviewUri(a.Uri.joinPath(this._extensionUri,"media","main.js")),i=e.asWebviewUri(a.Uri.joinPath(this._extensionUri,"resources","claude-icon.svg"));return`\n      <!DOCTYPE html>\n      <html lang="en">\n      <head>\n      <meta charset="UTF-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource}; img-src ${e.cspSource} data:; script-src 'nonce-${t}';">\n      <title>Claude Code Chat</title>\n      <link href="${s}" rel="stylesheet">\n      </head>\n      <body>\n      <div class="chat-container">\n\n        \x3c!-- Message container --\x3e\n        <div id="messages" class="messages"></div>\n        \n        \x3c!-- Input area styled like Claude --\x3e\n        <div class="input-container">\n        <div class="input-wrapper">\n          <textarea id="messageInput" placeholder="Ask Claude Code..." rows="1"></textarea>\n          <div class="input-actions">\n          <button id="sendButton">\n            Send\n            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" fill="currentColor"/>\n            </svg>\n          </button>\n          </div>\n        </div>\n        </div>\n        \n        \x3c!-- Claude attribution footer --\x3e\n        <div class="utility-row">\n        <div class="claude-attribution">\n          <img class="claude-flower" src="${i}" width="16" height="16" alt="Claude Icon" />\n          <span>Claude can make mistakes. Please double-check responses.</span>\n        </div>\n        <div class="claude-version">\n          <span>Claude 3.7 Sonnet</span>\n        </div>\n        </div>\n      </div>\n      <script nonce="${t}" src="${r}"><\/script>\n      </body>\n      </html>\n    `}}t.ChatWebviewProvider=d,d.viewType="claudeCodeChatView"},185:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getNonce=function(){let e="";for(let t=0;t<32;t++)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return e}},265:function(e,t,s){var r,i=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,i)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=r(e),o=0;o<s.length;o++)"default"!==s[o]&&i(t,e,s[o]);return n(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.activate=function(e){console.log("Claude Code extension is now active!");const t=new d.ClaudeCodeService;l=t;const s=new c.ChatWebviewProvider(e.extensionUri,t);e.subscriptions.push(a.window.registerWebviewViewProvider("claudeCodeChatView",s));const r=a.commands.registerCommand("claude-code-extension.startChat",(()=>{a.commands.executeCommand("claudeCodeChatView.focus")}));e.subscriptions.push(r),e.subscriptions.push({dispose:()=>{l&&l.stop()}}),t.start().catch((e=>{const t=e instanceof Error?e.message:String(e);a.window.showErrorMessage(`Failed to start Claude Code: ${t}`)}))},t.deactivate=function(){l&&(console.log("Stopping Claude Code process on deactivation"),l.stop(),l=void 0)};const a=o(s(398)),c=s(63),d=s(390);let l},317:e=>{e.exports=require("child_process")},390:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClaudeCodeService=void 0;const r=s(434),i=s(317);t.ClaudeCodeService=class{constructor(){this.messageEmitter=new r.EventEmitter,this.isProcessReady=!1,this.messageEmitter.setMaxListeners(100)}async start(){(0,i.exec)("which claude",((e,t,s)=>{if(e)return console.error(`Error checking for Claude: ${e.message}`),void this.messageEmitter.emit("error","Claude Code CLI is not installed or not in the PATH");console.log(`Found Claude at: ${t.trim()}`),this.isProcessReady=!0,this.messageEmitter.emit("ready"),this.messageEmitter.emit("message",{role:"assistant",content:"Claude Code found. How can I help you with your project?"})}))}async sendMessage(e){this.isProcessReady||await this.start(),this.messageEmitter.emit("message",{role:"user",content:e});const t="/tmp/claude_vscode_script.sh",r=`#!/bin/bash\n# Script to handle Claude interaction\n(echo "1"; echo "${e}") | TERM=xterm-256color claude -p 2>/dev/null\n`,n=s(896);n.writeFileSync(t,r),n.chmodSync(t,"755"),console.log("Executing Claude via script file"),(0,i.exec)(`bash ${t}`,{env:{...process.env,TERM:"xterm-256color"}},((e,s,r)=>{try{n.unlinkSync(t)}catch(e){console.error("Error removing temp file:",e)}if(e)return console.error(`Error from Claude: ${e.message}`),void this.messageEmitter.emit("error",`Error from Claude: ${e.message}`);r&&console.error(`Claude stderr: ${r}`),this.messageEmitter.emit("message",{role:"assistant",content:s.trim()||"No response received from Claude. There might be an issue with the CLI."}),console.log("Claude response sent to UI")}))}stop(){this.isProcessReady=!1}onMessage(e){const t=t=>{e(t)};return this.messageEmitter.on("message",t),{dispose:()=>{this.messageEmitter.removeListener("message",t)}}}onError(e){const t=t=>{e(t)};return this.messageEmitter.on("error",t),{dispose:()=>{this.messageEmitter.removeListener("error",t)}}}onExit(e){const t=t=>{e(t)};return this.messageEmitter.on("exit",t),{dispose:()=>{this.messageEmitter.removeListener("exit",t)}}}}},398:e=>{e.exports=require("vscode")},434:e=>{e.exports=require("events")},896:e=>{e.exports=require("fs")}},t={},s=function s(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r].call(n.exports,n,n.exports,s),n.exports}(265);module.exports=s})();
//# sourceMappingURL=extension.js.map